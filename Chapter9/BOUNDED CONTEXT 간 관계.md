# BOUNDED CONTEXT 간 관계

## 고객/공급자 관계

- 두 BOUNDED CONTEXT 간 관계 중 가장 흔한 관계는 한쪽에서 API를 제공하고 다른 한쪽에서 그 API를 호출하는 관계로, REST API가 대표적이다.
- 이 관계에서 API를 사용하는 BOUNDED CONTEXT는 API를 제공하는 BOUNDED CONTEXT에 의존하게 된다.

</br >

### 카탈로그와 추천 BOUNDED CONTEXT 예제

![image](https://user-images.githubusercontent.com/43977617/103900639-5d968d00-513b-11eb-8d81-2c711ee81892.png)

- 공급자: 상류 컴포넌트, 일종의 서비스 공급
- 고객: 하류 컴포넌트, 공급받은 서비스를 사용하는 고객

### 고객과 공급자의 상호 협력

고객과 공급자에 있는 두 팀은 상호 협력이 필수적이다.

- 공급자 역할을 하는 상류 팀이 마음대로 API를 변경하면 하류 팀은 변경된 API에 맞추느라 우선순위가 높은 다른 기능을 개발하지 못할 수도 있다.
- 상류 팀이 무언가를 변경할 때 하류 팀으로부터 여러 절차를 거쳐 승낙을 받아야 한다면 상류 팀은 새로운 개발 시도 자체를 하지 않을 수 도 있다.

따라서, 상류 팀과 하류 팀은 개발 계획을 서로 공유하고 일정을 협의해서 결정해야 한다.

</br >

## 공개 호스트 서비스(Open Host Service)

상류 컴포넌트는 보통 하류 컴포넌트가 사용할 수 있는 통신 프로토콜을 정의하고 이를 공개한다.

이때 상류 팀의 고객인 하류 팀이 다수 존재하면 **상류 팀은 여러 하류 팀의 요구사항을 수용할 수 있는 API를 만들고**, 이를 서비스 형태로 공개해서 서비스의 일관성을 유지할 수 있다. 이런 서비스를 가리켜 공개 호스트 서비스(Open Host Service)라 한다.

</br >

### 검색 예제

공개 호스트 서비스의 대표적인 예로 검색이 있다. 블로그, 카페, 게시판과 같은 서비스를 제공하는 포탈은 각 서비스별로 검색 기능을 구현하기보다는 **검색을 위한 전용 시스템을 구축하고 검색 시스템과 각 서비스를 통합한다.**

- 상류 컴포넌트: 검색 시스템
- 하류 컴포넌트: 블로그, 카페, 게시판

상류 팀은 각 하류 컴포넌트의 요구사항을 수용하는 단일 API를 만들어 이를 공개하고 각 하류 팀은 공개된 APi를 사용해서 검색 기능을 구현하게 된다.

![image](https://user-images.githubusercontent.com/43977617/103902707-41e0b600-513e-11eb-8227-876424dfb3d8.png)

</br >

## 안티코럽션 계층(Anticorruption Layer)

하류 컴포넌트는 상류 서비스의 모델이 자신의 도메인 모델에 영향을 주지 않도록 보호해주는 완충 지대를 만들어야 한다.

즉, 외부 시스템의 도메인 모델이 내 도메인 모델을 침범하지 않도록 막아줘야 하는데, 이것을 도와주는 계층을 안티코럽션 계층이라 한다.

![image](https://user-images.githubusercontent.com/43977617/103903108-cf240a80-513e-11eb-8a85-7ab422fe6cbc.png)

</br >

## 공유 커널(Shared Kernel)

두 BOUNDED CONTEXT가 같은 모델을 공유하는 경우가 있다.

예로, 운영자를 위한 주문 관리 도구를 개발하는 팀과 고객을 위한 주문 서비스를 개발하는 팀이 다르다고 가정할 때, 두 팀은 주문을 표현하는 모델을 공유함으로써 주문과 관련되 중복 개발을 막을 수 있다.

이렇게 두 팀이 공유하는 모델을 공유 커널이라 한다.

</br >

### 장단점

- 장점으로 중복을 줄여준다.
- 단점으로 두 팀이 한 모델을 공유하기 때문에 한 팀에서 임의로 모델을 변경해서는 안 된다.
  - 한 팀에서 마음대로 모델을 변경하게 된다면 공유 커널을 사용할 때의 장점보다 공유 커널로 인해 개발이 지연되고 정체되는 문제가 더 커지게 된다.

</br >

## 독립 방식(Separate Way)

독립 방식 관계는 서로 통합하지 않는 방식을 말한다. 두 BOUNDED CONTEXT 간에 통합을 하지 않으므로 서로 독립적으로 모델을 발전시킨다.

그렇기 때문에 두 BOUNDED CONTEXT 간의 통합은 수동으로 이뤄진다.

</br >

### 쇼핑몰 예제

![image](https://user-images.githubusercontent.com/43977617/103903786-af411680-513f-11eb-9c48-23fd022aa6ae.png)

두 BOUNDED CONTEXT 간의 연동을 지원하지 않으므로 온라인 쇼핑몰에서 판매가 발생하면 쇼핑몰 운영자는 쇼핑몰 시스템에서 판매 정보를 보고 수동으로 ERP 시스템에 입력해야 한다.

수동으로 통합하는 방식은 규모가 커질수로 한계가 있다. 그렇기 때문에 두 BOUNDED CONTEXT를 통합해 주는 별도의 시스템을 만들어야 할 수도 있다.

</br >

## 컨텍스트 맵

컨텍스트 맵은 BOUNDED CONTEXT 간의 관계를 표시한 것이다.

![image](https://user-images.githubusercontent.com/43977617/103904172-427a4c00-5140-11eb-9fb3-c43b96bdc82f.png)

위 그림은 오픈 호스트 서비스(OHS)와 안티코럽션 계층(ACL)만 표시했다. 그림만 봐도 각 BOUNDED CONTEXT의 경계가 명확하게 드러나고 서로 어떤 관계를 맺고 있는지 알 수 있다.

