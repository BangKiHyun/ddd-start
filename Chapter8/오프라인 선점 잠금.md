# 오프라인 선점 잠금

## 오프라인 선점 잠금이란?

여러 트랜잭션에 걸쳐 동시 변경을 막는 것으로, 단일 트랜잭션에서 동시 변경을 막는 선점 잠금 방식과 다르다.

즉, 첫 번째 트랜잭션을 시작할 때 오프라인 잠금을 선점하고, 마지막 트랜잭션에서 잠금을 해제한다. 잠금을 해제하기 전까지 다른 사용자는 잠금을 구할 수 없다.

</br >

## 수정 기능 예제

수정 기능을 생각해보면 보통 수정 기능은 두 개의 트랜잭션으로 구성된다.

1. 수정 폼을 보여준다.
2. 데이터를 수정한다.

이 때, 오프라인 선점 잠금을 사용하면 **첫 번째 수정 폼 요청 과정에서 잠금을 선점하고, 수정 과정을 거친 후 잠금을 해제**한다.

![image](https://user-images.githubusercontent.com/43977617/102747655-f7bcae00-43a3-11eb-93a6-aa0b4b1477ce.png)

</br >

## 유효 시간 설정

만약 수정 요청을 수정하지 않고 프로그램을 종료하게 되면 잠금을 해제하지 않으므로 다른 사용자는 영원히 잠금을 구할 수 없는 상황이 발생한다. 그러므로 오프라인 선점 잠금 방식은 잠금의 유효 시간을 가져야 한다.

만약 수정을 완료하는 시간보다 유효 시간이 더 짧다면 사용자는 수정에 실패하게 된다. 이런 상황을 만들지 않으려면 일정 주기로 유효 시간을 증가시키는 기능도 구현해야 한다.

